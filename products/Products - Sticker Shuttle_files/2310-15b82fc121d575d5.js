"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2310],{13160:(e,t,r)=>{r.d(t,{$2:()=>s,An:()=>a,Yx:()=>n,nH:()=>o}),console.error;async function o(){for(let e=1;e<=3;e++)try{console.log("Loading CSV files (attempt ".concat(e,"/").concat(3,")..."));let t=new Promise((e,t)=>setTimeout(()=>t(Error("CSV loading timeout")),1e4)),r=Promise.all([fetch("/orbit/base-price.csv"),fetch("/orbit/qty-sq.csv")]),[o,n]=await Promise.race([r,t]);if(console.log("CSV fetch responses:",{basePriceOk:o.ok,basePriceStatus:o.status,qtyDiscountOk:n.ok,qtyDiscountStatus:n.status}),!o.ok||!n.ok)throw Error("Failed to load pricing CSV files: base-price (".concat(o.status,"), qty-sq (").concat(n.status,")"));let a=Promise.all([o.text(),n.text()]),[s,i]=await Promise.race([a,t]);if(console.log("CSV file sizes:",{basePriceLength:s.length,qtyDiscountLength:i.length}),!s.trim()||!i.trim())throw Error("CSV files are empty or invalid");if(!s.includes("Sq. Inches")||!i.includes("Quantity"))throw Error("CSV files do not contain expected headers");let l=function(e){let t=e.trim().split("\n"),r=[];for(let e=1;e<t.length;e++){let[o,n]=t[e].split(",");if(o&&n){let e=parseInt(o.trim()),t=parseFloat(n.replace("$","").trim());isNaN(e)||isNaN(t)||r.push({sqInches:e,basePrice:t})}}return r.sort((e,t)=>e.sqInches-t.sqInches)}(s),c=function(e){let t=e.trim().split("\n"),r=t[1].split(","),o=[];for(let e=1;e<r.length;e++){let t=parseInt(r[e].trim());isNaN(t)||o.push(t)}let n=[];for(let e=2;e<t.length;e++){let r=t[e].split(",");if(r.length>0&&!r[0].trim().startsWith("*")){let e=r[0].trim();e.startsWith('"')&&r.length>1&&r[1].includes('"')&&(e=e.replace('"',"")+r[1].replace('"',""),r.splice(1,1));let t=parseInt(e=e.replace(/[",\s]/g,""));if(!isNaN(t)&&t>0){let e={};for(let t=1;t<r.length&&t-1<o.length;t++){let n=parseFloat(r[t].trim());isNaN(n)||(e[o[t-1]]=n)}n.push({quantity:t,discounts:e})}}}return n.sort((e,t)=>e.quantity-t.quantity)}(i);if(0===l.length||0===c.length)throw Error("Failed to parse CSV data - no valid entries found");return console.log("Successfully loaded pricing data:",{basePricing:l.length,quantityDiscounts:c.length}),{basePricing:l,quantityDiscounts:c}}catch(o){let t="CSV loading attempt ".concat(e," failed: ").concat(o instanceof Error?o.message:"Unknown error");if(1===e||3===e?console.error(t):console.warn("Retry ".concat(e,"/").concat(3," failed, retrying...")),3===e){if(console.error("All CSV loading attempts failed, throwing error"),o instanceof TypeError&&o.message.includes("fetch"))throw Error("Network error: CSV files may not be accessible. Please check your internet connection and try again.");throw o}let r=Math.min(1e3*Math.pow(2,e-1),5e3);console.log("Waiting ".concat(r,"ms before retry...")),await new Promise(e=>setTimeout(e,r))}throw Error("Unexpected error in CSV loading")}function n(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(e,t){let r=e.find(e=>e.sqInches===t);if(r)return r.basePrice;let o=e.sort((e,t)=>e.sqInches-t.sqInches);if(t<=o[0].sqInches)return o[0].basePrice;if(t>=o[o.length-1].sqInches)return o[o.length-1].basePrice;for(let e=0;e<o.length-1;e++)if(t>=o[e].sqInches&&t<=o[e+1].sqInches){let r=(t-o[e].sqInches)/(o[e+1].sqInches-o[e].sqInches);return o[e].basePrice+r*(o[e+1].basePrice-o[e].basePrice)}return o[0].basePrice}(e,r),s=function(e,t,r){let o=50;for(let r of e)if(t>=r.quantity)o=r.quantity;else break;let n=e.find(e=>e.quantity===o);if(!n)return 0;let a=Object.keys(n.discounts).map(e=>parseInt(e)).sort((e,t)=>e-t),s=a[0];for(let e of a)if(r>=e)s=e;else break;return n.discounts[s]||0}(t,o,r),i=a;s>0&&(i=a*(1-s)),n&&(i*=1.4);let l=i*o;return{basePrice:a,discountMultiplier:s,finalPricePerSticker:i,totalPrice:l,sqInches:r,quantity:o}}function a(e,t){return e*t}let s={small:{width:2,height:2,sqInches:4,label:"Small (2″ \xd7 2″)"},medium:{width:3,height:3,sqInches:9,label:"Medium (3″ \xd7 3″)"},large:{width:4,height:4,sqInches:16,label:"Large (4″ \xd7 4″)"},xlarge:{width:5,height:5,sqInches:25,label:"X-Large (5″ \xd7 5″)"}}},32146:(e,t,r)=>{r.d(t,{CK:()=>o});function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.05;if(t>=100)return{creditAmount:0,potentialAmount:e*r,isLimitReached:!0,isLimitExceeded:!1,message:"You've reached the $".concat("100.00"," credit limit. Please use your existing credits to earn more.")};let o=e*r;if(t+o>100){let e=100-t;return{creditAmount:e,potentialAmount:o,isLimitReached:!1,isLimitExceeded:!0,message:"You'll earn $".concat(e.toFixed(2)," in store credit (capped at $").concat("100.00"," limit). Without the limit, you would have earned $").concat(o.toFixed(2),".")}}return{creditAmount:o,potentialAmount:o,isLimitReached:!1,isLimitExceeded:!1,message:"You'll earn $".concat(o.toFixed(2)," in store credit on this order!")}}},42230:(e,t,r)=>{r.d(t,{A:()=>m});var o=r(28888),n=r(37876),a=r(14232),s=r(79350),i=r(78248),l=r(64177);function c(){let e=(0,o._)(["\n  query ValidateDiscountCode($code: String!, $orderAmount: Float!, $sessionId: String) {\n    validateDiscountCode(code: $code, orderAmount: $orderAmount, sessionId: $sessionId) {\n      valid\n      discountCode {\n        id\n        code\n        discountType\n        discountValue\n      }\n      discountAmount\n      message\n    }\n  }\n"]);return c=function(){return e},e}function d(){let e=(0,o._)(["\n  mutation RemoveDiscountSession($sessionId: String) {\n    removeDiscountSession(sessionId: $sessionId) {\n      success\n    }\n  }\n"]);return d=function(){return e},e}let u=(0,s.J1)(c()),p=(0,s.J1)(d());function m(e){let{orderAmount:t,onDiscountApplied:r,className:o="",currentAppliedDiscount:s,hasReorderDiscount:c,reorderDiscountAmount:d,hasStoreCredits:m}=e,[h,g]=(0,a.useState)(""),[f,x]=(0,a.useState)(!1),[v,_]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[w]=(0,a.useState)(()=>(function(){let e="ss_discount_session_id",t=localStorage.getItem(e);return t||(t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxx-xxxx-xxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16)),localStorage.setItem(e,t)),t})());a.useEffect(()=>{console.log("\uD83D\uDD04 DiscountCodeInput: currentAppliedDiscount changed:",s),s&&s.code?(g(s.code),_({valid:!0,discountCode:{code:s.code,discountType:"unknown",discountValue:0},discountAmount:s.amount,message:'Discount code "'.concat(s.code,'" applied')}),y(!0)):s||(console.log("\uD83D\uDD04 DiscountCodeInput: Clearing all discount state"),g(""),_(null),y(!1))},[s]);let[k]=(0,i._)(u,{onCompleted:e=>{let t=e.validateDiscountCode;if(_(t),x(!1),t.valid){if(s&&s.code!==t.discountCode.code){_({valid:!1,message:'Cannot apply "'.concat(t.discountCode.code,'". Remove "').concat(s.code,'" first to use a different discount code.'),showResetOption:!0}),r(null);return}r({code:t.discountCode.code,amount:t.discountAmount})}else r(null)},onError:e=>{console.error("Error validating discount:",e),_({valid:!1,message:"Error validating discount code"}),r(null),x(!1)}}),[C]=(0,l.n)(p,{onCompleted:e=>{var t;console.log("✅ Discount session removed successfully:",null==e||null==(t=e.removeDiscountSession)?void 0:t.success)},onError:e=>{console.error("⚠️ Error removing discount session (non-blocking):",e.message)}}),S=async()=>{if(h.trim()){if(m){_({valid:!1,message:"Cannot apply discount codes with store credit. Remove store credit to use discount codes.",showResetOption:!1}),y(!0);return}if(c){_({valid:!1,message:"Cannot apply discount codes with reorder discount. You're already saving ".concat(d?"$".concat(d.toFixed(2)):"10%"," on this reorder!")}),y(!0);return}if(s&&s.code!==h.toUpperCase()){console.log("\uD83D\uDEAB DiscountCodeInput: Preventing multiple discount codes"),console.log("   Current:",s.code),console.log("   Trying:",h.toUpperCase()),_({valid:!1,message:'Cannot apply multiple discount codes. Remove "'.concat(s.code,'" first to use a different discount code.'),showResetOption:!0}),y(!0);return}if(s&&s.code===h.toUpperCase()){_({valid:!0,discountCode:{code:s.code,discountType:"unknown",discountValue:0},discountAmount:s.amount,message:'Discount code "'.concat(s.code,'" is already applied')}),y(!0);return}x(!0),y(!0),k({variables:{code:h.toUpperCase(),orderAmount:t,sessionId:w}})}};return(0,n.jsxs)("div",{className:"space-y-3 ".concat(o),children:[m&&(0,n.jsxs)("div",{className:"text-sm px-4 py-3 rounded-lg",style:{background:"linear-gradient(135deg, rgba(250, 204, 21, 0.4) 0%, rgba(250, 204, 21, 0.25) 50%, rgba(250, 204, 21, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(250, 204, 21, 0.4)",boxShadow:"rgba(250, 204, 21, 0.15) 0px 4px 16px, rgba(255, 255, 255, 0.2) 0px 1px 0px inset",color:"rgb(254, 240, 138)"},children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsxs)("svg",{className:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,n.jsx)("path",{d:"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z",clipRule:"evenodd"})]}),(0,n.jsx)("span",{className:"font-medium",children:"Store Credit Active"})]}),(0,n.jsx)("div",{className:"text-xs mt-1 opacity-90",children:"Cannot apply discount codes while using store credit."})]}),c&&(0,n.jsxs)("div",{className:"text-sm px-4 py-3 rounded-lg",style:{background:"linear-gradient(135deg, rgba(245, 158, 11, 0.4) 0%, rgba(245, 158, 11, 0.25) 50%, rgba(245, 158, 11, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(245, 158, 11, 0.4)",boxShadow:"rgba(245, 158, 11, 0.15) 0px 4px 16px, rgba(255, 255, 255, 0.2) 0px 1px 0px inset",color:"rgb(254, 240, 138)"},children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-amber-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),(0,n.jsxs)("span",{className:"font-medium",children:["Reorder Discount Active: ",d?"$".concat(d.toFixed(2)):"10%"," off"]})]}),(0,n.jsx)("div",{className:"text-xs mt-1 opacity-90",children:"Additional discount codes cannot be applied with reorder discounts."})]}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsxs)("div",{className:"relative flex-1",children:[(0,n.jsx)("input",{type:"text",placeholder:"Discount code",value:h,onChange:e=>g(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&S(),disabled:(null==v?void 0:v.valid)||c||m,className:"w-full rounded-xl px-4 py-3 pl-11 text-white text-sm placeholder-white/60 focus:outline-none transition-all disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.02) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"rgba(0, 0, 0, 0.1) 0px 2px 8px inset, rgba(255, 255, 255, 0.1) 0px 1px 0px"}}),(0,n.jsx)("svg",{className:"w-4 h-4 text-purple-400 absolute left-3 top-1/2 transform -translate-y-1/2 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})]}),(null==v?void 0:v.valid)?(0,n.jsx)("button",{onClick:()=>{console.log("\uD83D\uDD04 DiscountCodeInput: Removing discount"),g(""),_(null),y(!1),r(null);try{C({variables:{sessionId:w}}).catch(e=>{console.warn("⚠️ Backend session cleanup failed (non-critical):",(null==e?void 0:e.message)||e)})}catch(e){console.warn("⚠️ Backend session cleanup error (non-critical):",(null==e?void 0:e.message)||e)}console.log("✅ DiscountCodeInput: Discount removed and parent notified")},className:"px-6 py-3 rounded-xl font-semibold text-white text-sm transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.4) 0%, rgba(239, 68, 68, 0.25) 50%, rgba(239, 68, 68, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(239, 68, 68, 0.4)",boxShadow:"0 4px 16px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,n.jsx)("span",{children:"Remove"})]})}):(0,n.jsx)("button",{onClick:S,disabled:f||!h.trim()||c||m,className:"px-6 py-3 rounded-xl font-semibold text-white text-sm transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg hover:shadow-xl",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.4) 0%, rgba(59, 130, 246, 0.25) 50%, rgba(59, 130, 246, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(59, 130, 246, 0.4)",boxShadow:"0 4px 16px rgba(59, 130, 246, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:f?(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,n.jsx)("span",{children:"Checking..."})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,n.jsx)("span",{children:"Apply"})]})})]}),b&&v&&(0,n.jsx)("div",{className:"text-sm px-4 py-2 rounded-lg",style:v.valid?{background:"linear-gradient(135deg, rgba(250, 204, 21, 0.4) 0%, rgba(250, 204, 21, 0.25) 50%, rgba(250, 204, 21, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(250, 204, 21, 0.4)",boxShadow:"rgba(250, 204, 21, 0.15) 0px 4px 16px, rgba(255, 255, 255, 0.2) 0px 1px 0px inset",color:"rgb(254, 240, 138)"}:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.4) 0%, rgba(239, 68, 68, 0.25) 50%, rgba(239, 68, 68, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(239, 68, 68, 0.4)",boxShadow:"rgba(239, 68, 68, 0.15) 0px 4px 16px, rgba(255, 255, 255, 0.2) 0px 1px 0px inset",color:"rgb(252, 165, 165)"},children:v.valid?(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 min-w-0 flex-1",children:[(0,n.jsx)("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,n.jsx)("span",{className:"text-xs truncate",children:v.message})]}),(0,n.jsxs)("span",{className:"font-semibold text-xs ml-2 flex-shrink-0",children:[(()=>{if(!(null==v?void 0:v.discountCode))return"";let{discountType:e,discountValue:t}=v.discountCode;return"percentage"===e?"".concat(t,"% off"):"fixed_amount"===e?"$".concat(t," off"):"Free shipping"})()," = -$",v.discountAmount.toFixed(2)]})]}):(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,n.jsx)("span",{children:v.message})]}),v.showResetOption&&(0,n.jsx)("button",{onClick:()=>{console.log("\uD83D\uDD04 FORCE RESET: Clearing all discount state"),g(""),_(null),y(!1),r(null),setTimeout(()=>{r(null),console.log("✅ FORCE RESET: Secondary parent notification sent")},100),localStorage.removeItem("ss_discount_session_id");let e="xxxx-xxxx-xxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16));localStorage.setItem("ss_discount_session_id",e);try{C({variables:{sessionId:w}}).catch(e=>{console.warn("⚠️ Force reset: Backend session cleanup failed (non-critical):",(null==e?void 0:e.message)||e)})}catch(e){console.warn("⚠️ Force reset: Backend session cleanup error (non-critical):",(null==e?void 0:e.message)||e)}console.log("✅ FORCE RESET: Complete - all state cleared")},className:"ml-3 px-3 py-1 text-xs rounded-lg font-medium transition-all hover:bg-red-500/20 border border-red-400/30 text-red-300",title:"Reset discount state",children:"Reset"})]})})]})}},65939:(e,t,r)=>{r.d(t,{IR:()=>h,XZ:()=>g,Xd:()=>f,Y2:()=>m});var o=r(28888),n=r(79350);function a(){let e=(0,o._)(["\n  mutation DeleteUsers($userIds: [String!]!) {\n    deleteUsers(userIds: $userIds) {\n      success\n      deletedCount\n      errors {\n        userId\n        error\n      }\n    }\n  }\n"]);return a=function(){return e},e}function s(){let e=(0,o._)(["\n  query GetUserDetails($userIds: [String!]!) {\n    getUserDetails(userIds: $userIds) {\n      id\n      email\n      firstName\n      lastName\n      createdAt\n      lastSignIn\n      totalOrders\n      totalSpent\n    }\n  }\n"]);return s=function(){return e},e}function i(){let e=(0,o._)(["\n  mutation BackupUserData($userId: String!) {\n    backupUserData(userId: $userId) {\n      success\n      backupId\n      error\n    }\n  }\n"]);return i=function(){return e},e}function l(){let e=(0,o._)(["\n  mutation CreateSharedCart($input: CreateSharedCartInput!) {\n    createSharedCart(input: $input) {\n      success\n      sharedCart {\n        id\n        shareId\n        cartData\n        createdBy\n        createdAt\n        expiresAt\n        accessCount\n        lastAccessAt\n      }\n      shareUrl\n      error\n    }\n  }\n"]);return l=function(){return e},e}function c(){let e=(0,o._)(["\n  query GetSharedCart($shareId: String!) {\n    getSharedCart(shareId: $shareId) {\n      success\n      sharedCart {\n        id\n        shareId\n        cartData\n        createdBy\n        createdAt\n        expiresAt\n        accessCount\n        lastAccessAt\n      }\n      error\n    }\n  }\n"]);return c=function(){return e},e}function d(){let e=(0,o._)(["\n  query GetAllSharedCarts($offset: Int, $limit: Int) {\n    getAllSharedCarts(offset: $offset, limit: $limit) {\n      success\n      sharedCarts {\n        id\n        shareId\n        cartData\n        createdBy\n        createdAt\n        expiresAt\n        accessCount\n        lastAccessAt\n      }\n      totalCount\n      error\n    }\n  }\n"]);return d=function(){return e},e}function u(){let e=(0,o._)(["\n  query GetAllWholesaleCustomers {\n    getAllWholesaleCustomers {\n      id\n      userId\n      firstName\n      lastName\n      companyName\n      isWholesaleCustomer\n      wholesaleCreditRate\n      wholesaleMonthlyCustomers\n      wholesaleOrderingFor\n      wholesaleFitExplanation\n      wholesaleStatus\n      wholesaleApprovedAt\n      wholesaleApprovedBy\n      isTaxExempt\n      taxExemptId\n      taxExemptReason\n      taxExemptExpiresAt\n      taxExemptUpdatedAt\n      taxExemptUpdatedBy\n      createdAt\n      updatedAt\n    }\n  }\n"]);return u=function(){return e},e}function p(){let e=(0,o._)(["\n  query GetAllCustomersWithProfiles {\n    getAllWholesaleCustomers {\n      id\n      userId\n      firstName\n      lastName\n      companyName\n      isWholesaleCustomer\n      isTaxExempt\n      taxExemptId\n      taxExemptReason\n      taxExemptExpiresAt\n      taxExemptUpdatedAt\n      taxExemptUpdatedBy\n      createdAt\n      updatedAt\n    }\n  }\n"]);return p=function(){return e},e}(0,n.J1)(a()),(0,n.J1)(s()),(0,n.J1)(i());let m=(0,n.J1)(l()),h=(0,n.J1)(c()),g=(0,n.J1)(d());(0,n.J1)(u());let f=(0,n.J1)(p())},79215:(e,t,r)=>{r.d(t,{A:()=>H});var o,n=r(37876),a=r(14232),s=r(89099),i=r(7931),l=r(64177),c=r(28888),d=r(79350);function u(){let e=(0,c._)(["\n  mutation ProcessStripeCartOrder($input: CartOrderInput!) {\n    processStripeCartOrder(input: $input) {\n      success\n      sessionId\n      checkoutUrl\n      customerOrder {\n        id\n        userId\n        guestEmail\n        stripePaymentIntentId\n        stripeCheckoutSessionId\n        orderNumber\n        orderStatus\n        fulfillmentStatus\n        financialStatus\n        trackingNumber\n        trackingCompany\n        trackingUrl\n        subtotalPrice\n        totalTax\n        totalPrice\n        currency\n        customerFirstName\n        customerLastName\n        customerEmail\n        customerPhone\n        shippingAddress\n        billingAddress\n        shipping_method\n        is_express_shipping\n        is_rush_order\n        is_blind_shipment\n        orderTags\n        orderNote\n        orderCreatedAt\n        orderUpdatedAt\n        createdAt\n        updatedAt\n        proof_status\n        proof_sent_at\n        proof_link\n        discountCode\n        discountAmount\n      }\n      message\n      errors\n      creditsApplied\n      remainingCredits\n    }\n  }\n"]);return u=function(){return e},e}function p(){let e=(0,c._)(["\n  mutation CreateStripeCheckoutSession($input: StripeCheckoutInput!) {\n    createStripeCheckoutSession(input: $input) {\n      success\n      sessionId\n      checkoutUrl\n      totalAmount\n      message\n      error\n    }\n  }\n"]);return p=function(){return e},e}function m(){let e=(0,c._)(["\n  mutation CreateAdditionalPaymentLink($input: AdditionalPaymentInput!) {\n    createAdditionalPaymentLink(input: $input) {\n      success\n      sessionId\n      checkoutUrl\n      message\n      errors\n    }\n  }\n"]);return m=function(){return e},e}let h=(0,d.J1)(u());(0,d.J1)(p()),(0,d.J1)(m());var g="basil",f="https://js.stripe.com",x="".concat(f,"/").concat(g,"/stripe.js"),v=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,_=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,b=function(){for(var e=document.querySelectorAll('script[src^="'.concat(f,'"]')),t=0;t<e.length;t++){var r,o=e[t];if(r=o.src,v.test(r)||_.test(r))return o}return null},y=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(x).concat(t);var o=document.head||document.body;if(!o)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(r),r},w=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"7.3.1",startTime:t})},k=null,C=null,S=null,I=function(e,t,r){if(null===e)return null;var o,n=t[0].match(/^pk_test/),a=3===(o=e.version)?"v3":o;n&&a!==g&&console.warn("Stripe.js@".concat(a," was loaded on the page, but @stripe/stripe-js@").concat("7.3.1"," expected Stripe.js@").concat(g,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var s=e.apply(void 0,t);return w(s,r),s},N=!1,A=function(){return o?o:o=(null!==k?k:(k=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document)return void e(null);if(window.Stripe,window.Stripe)return void e(window.Stripe);try{var r,o=b();o?o&&null!==S&&null!==C&&(o.removeEventListener("load",S),o.removeEventListener("error",C),null==(r=o.parentNode)||r.removeChild(o),o=y(null)):o=y(null),S=function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))},C=function(e){t(Error("Failed to load Stripe.js",{cause:e}))},o.addEventListener("load",S),o.addEventListener("error",C)}catch(e){t(e);return}})).catch(function(e){return k=null,Promise.reject(e)})).catch(function(e){return o=null,Promise.reject(e)})};Promise.resolve().then(function(){return A()}).catch(function(e){N||console.warn(e)});let E="pk_live_51Rb2vbGa1Enjy4M4c2xNnHkDXQV5BNJi72Y1qGpCXQEecPKkVwg7kVfpHwMhYS99wGWfJqlASW1jq3WcJbTgB8du002AUxHz3H";E||(console.error("❌ NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY is not defined in environment variables"),console.error("Please add NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY to your .env.local file"));let P=E?function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];N=!0;var o=Date.now();return A().then(function(e){return I(e,t,o)})}(E):null,j=()=>{let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(null),[n]=(0,l.n)(h);return{processCheckout:async function(e,r,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8];t(!0),o(null);try{let t=null;try{{let e=(0,i.b)(),{data:{session:r}}=await e.auth.getSession();t=(null==r?void 0:r.user)||null}}catch(e){console.warn("Could not get user context, proceeding as guest:",e)}let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=parseFloat(e);return isNaN(r)?t:r},{data:m}=await n({variables:{input:{userId:(null==t?void 0:t.id)||null,guestEmail:t?null:r.email,cartItems:e.map(e=>{var t,r,n,a,s,i,l,c,d,u;let p=o(e.unitPrice||e.price||e.totalPrice,0),m=o(e.totalPrice||e.price,0);return(0===p||0===m)&&console.warn("⚠️ Item with zero price detected:",{name:e.name||e.title,unitPrice:e.unitPrice,totalPrice:e.totalPrice,price:e.price}),{productId:(null==(t=e.product)?void 0:t.id)||e.productId||"PRODUCT-".concat(Date.now()),productName:(null==(r=e.product)?void 0:r.name)||e.name||e.title||"Custom Stickers",productCategory:(null==(n=e.product)?void 0:n.category)||e.category||"Custom Stickers",sku:(null==(a=e.product)?void 0:a.sku)||e.sku||"".concat((null==(s=e.product)?void 0:s.id)||"CUSTOM","-").concat(Date.now()),quantity:e.quantity||1,unitPrice:p,totalPrice:m,calculatorSelections:(null==(i=e.customization)?void 0:i.selections)||e.calculatorSelections||{},customization:e.customization||{},customFiles:(null==(l=e.customization)?void 0:l.customFiles)||e.customFiles||[],customerNotes:(null==(c=e.customization)?void 0:c.notes)||e.customerNotes||"",instagramHandle:(null==(d=e.customization)?void 0:d.instagramHandle)||e.instagramHandle||"",instagramOptIn:(null==(u=e.customization)?void 0:u.instagramOptIn)||e.instagramOptIn||!1}}),customerInfo:{firstName:r.firstName||r.first_name||"",lastName:r.lastName||r.last_name||"",email:r.email,phone:r.phone||""},shippingAddress:a,billingAddress:s||a,orderNote:l,discountCode:c,discountAmount:o(d,0),creditsToApply:o(u,0),isBlindShipment:p||!1}}}),h=m.processStripeCartOrder;if(!h.success){console.error("❌ Order processing failed with errors:",h.errors),console.error("❌ Full result object:",JSON.stringify(h,null,2)),console.error("❌ Backend error message:",h.message),console.error("❌ Backend error details:",h.errors);let e=h.message||"Order processing failed",t=h.errors?" Details: ".concat(JSON.stringify(h.errors)):"";throw Error("".concat(e).concat(t))}if(!P)throw Error("Stripe is not configured. Please check NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY environment variable.");let g=await P;if(!g)throw Error("Stripe failed to load");if(window.fbq)try{let t=e.map(e=>{var t;return(null==(t=e.product)?void 0:t.id)||e.id||"custom"}),r=e.map(e=>{var t;return{id:(null==(t=e.product)?void 0:t.id)||e.id||"custom",quantity:e.quantity||1,item_price:o(e.unitPrice||e.price,0)}}),n=e.reduce((e,t)=>e+o(t.totalPrice||t.price,0),0);window.fbq("track","AddPaymentInfo",{content_ids:t,contents:r,currency:"USD",value:n}),console.log("\uD83D\uDCCA Facebook Pixel: AddPaymentInfo tracked",{value:n,sessionId:h.sessionId})}catch(e){console.error("\uD83D\uDCCA Facebook Pixel AddPaymentInfo tracking error:",e)}let{error:f}=await g.redirectToCheckout({sessionId:h.sessionId});if(f)throw console.error("❌ Stripe redirect error:",f),Error(f.message);return{success:!0,customerOrder:h.customerOrder,sessionId:h.sessionId,checkoutUrl:h.checkoutUrl}}catch(t){console.error("❌ Stripe checkout error:",t);let e="Checkout failed";return t.graphQLErrors&&t.graphQLErrors.length>0?e=t.graphQLErrors[0].message:t.networkError?e="Network error: ".concat(t.networkError.message):t.message&&(e=t.message),o(e),{success:!1,error:e}}finally{t(!1)}},loading:e,error:r}};var D=r(54431),O=r(34268),F=r(36854);class q{isReady(){return this.posthog&&this.posthog.__loaded}getUserProperties(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={timestamp:new Date().toISOString(),url:window.location.href,user_agent:window.navigator.userAgent};return e?{...t,user_id:e.id,user_email:e.email,user_type:"registered"}:{...t,user_type:"guest"}}trackOrderCompleted(e){var t,r;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.isReady())return;let n={...this.getUserProperties(o),order_id:e.id,order_number:e.orderNumber||e.order_number,order_value:parseFloat(e.totalPrice||e.total_price),subtotal:parseFloat(e.subtotalPrice||e.subtotal_price||0),tax_amount:parseFloat(e.totalTax||e.total_tax||0),items_count:(null==(t=e.lineItems)?void 0:t.length)||(null==(r=e.line_items)?void 0:r.length)||1,financial_status:e.financialStatus||e.financial_status,order_status:e.orderStatus||e.order_status,payment_method:"stripe",currency:"USD",customer_email:e.customerEmail||e.customer_email||(null==o?void 0:o.email),is_guest_order:!o||"guest"===o.id,credits_used:e.creditsApplied||0,order_created_at:e.orderCreatedAt||e.created_at};this.posthog.capture("order_completed",n),this.posthog.capture("aov_data_point",{order_value:n.order_value,customer_email:n.customer_email,order_date:n.timestamp}),console.log("\uD83D\uDCCA Analytics: Order completed tracked",n)}trackCustomerValue(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!this.isReady())return;let n={customer_email:e,current_order_value:parseFloat(t),is_repeat_customer:r,total_orders_to_date:o,order_date:new Date().toISOString()};this.posthog.capture("customer_value_update",n),2===o?this.posthog.capture("customer_second_purchase",n):o>=5&&this.posthog.capture("customer_high_value",n),console.log("\uD83D\uDCCA Analytics: Customer value tracked",n)}trackOrderStatusChange(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.isReady())return;let o={order_id:e.id,order_number:e.orderNumber||e.order_number,new_status:t,previous_status:r,status_change_timestamp:new Date().toISOString(),order_created_at:e.orderCreatedAt||e.created_at,customer_email:e.customerEmail||e.customer_email};if(e.orderCreatedAt||e.created_at){let t=new Date(e.orderCreatedAt||e.created_at);o.hours_from_order_creation=Math.round((new Date-t)/36e5*100)/100}this.posthog.capture("order_status_changed",o),"Printing"===t?this.posthog.capture("order_production_started",o):"Shipped"===t||"In Transit"===t?this.posthog.capture("order_shipped",{...o,turnaround_time_hours:o.hours_from_order_creation}):"Delivered"===t&&this.posthog.capture("order_delivered",o),console.log("\uD83D\uDCCA Analytics: Order status change tracked",o)}trackCustomerPurchasePattern(e,t){if(!this.isReady())return;let r={customer_email:e,total_orders:t.totalOrders||1,total_spent:parseFloat(t.totalSpent||0),first_order_date:t.firstOrderDate,last_order_date:t.lastOrderDate,is_repeat_customer:(t.totalOrders||1)>1,days_since_first_order:t.daysSinceFirstOrder||0,average_order_value:t.averageOrderValue||0};this.posthog.capture("customer_purchase_pattern",r),2===r.total_orders&&this.posthog.capture("first_repeat_purchase",r),console.log("\uD83D\uDCCA Analytics: Customer purchase pattern tracked",r)}trackProductSale(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.isReady())return;let o={...this.getUserProperties(r),product_id:e.id,product_name:e.name,product_category:e.category||"stickers",product_type:e.productType||e.product_type,quantity:parseInt(e.quantity||1),unit_price:parseFloat(e.unitPrice||e.unit_price||0),total_price:parseFloat(e.totalPrice||e.total_price||0),product_options:e.options||{},order_id:t.id,order_number:t.orderNumber||t.order_number,order_total:parseFloat(t.totalPrice||t.total_price)};this.posthog.capture("product_sold",o),this.posthog.capture("product_revenue",{product_name:o.product_name,product_category:o.product_category,revenue:o.total_price,quantity:o.quantity,order_date:new Date().toISOString()}),console.log("\uD83D\uDCCA Analytics: Product sale tracked",o)}trackProofCreated(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isReady())return;let r={order_id:e.id,order_number:e.orderNumber||e.order_number,proof_created_at:new Date().toISOString(),customer_email:e.customerEmail||e.customer_email,proof_count:t.proofCount||1,order_created_at:e.orderCreatedAt||e.created_at};if(e.orderCreatedAt||e.created_at){let t=new Date(e.orderCreatedAt||e.created_at);r.hours_to_proof_creation=Math.round((new Date-t)/36e5*100)/100}this.posthog.capture("proof_created",r),console.log("\uD83D\uDCCA Analytics: Proof created tracked",r)}trackProofApproved(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isReady())return;let r={order_id:e.id,order_number:e.orderNumber||e.order_number,proof_approved_at:new Date().toISOString(),customer_email:e.customerEmail||e.customer_email,proof_created_at:t.proofCreatedAt,order_created_at:e.orderCreatedAt||e.created_at};if(t.proofCreatedAt){let e=new Date(t.proofCreatedAt);r.proof_approval_time_hours=Math.round((new Date-e)/36e5*100)/100}if(e.orderCreatedAt||e.created_at){let t=new Date(e.orderCreatedAt||e.created_at);r.total_hours_to_proof_approval=Math.round((new Date-t)/36e5*100)/100}this.posthog.capture("proof_approved",r),console.log("\uD83D\uDCCA Analytics: Proof approved tracked",r)}trackCartEvent(e,t){var r,o;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.isReady())return;let a={...this.getUserProperties(n),cart_value:parseFloat(t.totalPrice||0),items_count:(null==(r=t.items)?void 0:r.length)||0,cart_items:(null==(o=t.items)?void 0:o.map(e=>({product_name:e.name,quantity:e.quantity,price:e.price})))||[]};this.posthog.capture("cart_".concat(e),a),console.log("\uD83D\uDCCA Analytics: Cart ".concat(e," tracked"),a)}trackUserEngagement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isReady()&&this.posthog.capture("user_".concat(e),{...t,timestamp:new Date().toISOString()})}trackError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isReady()&&this.posthog.capture("error_occurred",{error_type:e,error_data:t,timestamp:new Date().toISOString(),url:window.location.href})}constructor(){this.posthog=F.Ay}}let U=new q,L=(e,t)=>U.trackOrderCompleted(e,t),R=(e,t,r,o)=>U.trackCustomerValue(e,t,r,o),$=(e,t)=>U.trackCustomerPurchasePattern(e,t),T=(e,t,r)=>U.trackCartEvent(e,t,r),B=(e,t)=>U.trackUserEngagement(e,t),z=()=>{let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(0),n=(0,a.useRef)(null),s=(0,a.useRef)(null),{data:l,refetch:c}=(0,D.IT)(O.p4,{fetchPolicy:"network-only",skip:!0}),d=(0,a.useCallback)(async()=>{try{{let e=(0,i.b)(),{data:{session:t}}=await e.auth.getSession();if(s.current=(null==t?void 0:t.user)||null,s.current){console.log("\uD83D\uDD0D Order monitoring initialized for user:",s.current.email);let{data:e}=await c({userId:s.current.id});(null==e?void 0:e.getUserOrders)&&(o(e.getUserOrders.length),console.log("\uD83D\uDCCA Initial order count:",e.getUserOrders.length))}}}catch(e){console.error("Error initializing user for order monitoring:",e)}},[c]),u=(0,a.useCallback)(async()=>e?void console.log("⚠️ Order monitoring already active"):(await d(),s.current)?void(console.log("\uD83D\uDE80 Starting order completion monitoring for user:",s.current.email),t(!0),n.current=setInterval(async()=>{try{console.log("\uD83D\uDD0D Checking for new orders...");let{data:t}=await c({userId:s.current.id});if(null==t?void 0:t.getUserOrders){let n=t.getUserOrders.length;if(console.log("\uD83D\uDCCA Order count check: ".concat(r," → ").concat(n)),n>r){let a=n-r;console.log("\uD83C\uDF89 Detected ".concat(a," new order(s)!"));let i=t.getUserOrders.slice(0,a).find(e=>"paid"===e.financialStatus&&"Creating Proofs"===e.orderStatus);if(i){console.log("✅ New paid order detected:",{id:i.id,orderNumber:i.orderNumber,orderStatus:i.orderStatus,financialStatus:i.financialStatus,totalPrice:i.totalPrice});try{var e;if(L(i,s.current),window.fbq)try{let e=parseFloat(i.totalPrice||i.total_price||0),t=i.lineItems||i.items||[],r=t.map(e=>e.product_id||e.id||"custom"),o=t.map(e=>({id:e.product_id||e.id||"custom",quantity:parseInt(e.quantity||1),item_price:parseFloat(e.price||e.unitPrice||0)}));window.fbq("track","Purchase",{content_ids:r,contents:o,content_type:"product",currency:"USD",value:e,num_items:t.length}),console.log("\uD83D\uDCCA Facebook Pixel: Purchase tracked",{order_number:i.orderNumber,value:e,num_items:t.length})}catch(e){console.error("\uD83D\uDCCA Facebook Pixel Purchase tracking error:",e)}let r=i.customerEmail||(null==(e=s.current)?void 0:e.email);if(r){let e=t.getUserOrders.filter(e=>(e.customerEmail||e.customer_email)===r||s.current&&e.userId===s.current.id),o=e.length,n=o>1,a=e.reduce((e,t)=>e+parseFloat(t.totalPrice||t.total_price||0),0);R(r,i.totalPrice,n,o);let l=e.sort((e,t)=>new Date(e.orderCreatedAt||e.created_at)-new Date(t.orderCreatedAt||t.created_at))[0],c={totalOrders:o,totalSpent:a,firstOrderDate:(null==l?void 0:l.orderCreatedAt)||(null==l?void 0:l.created_at),lastOrderDate:i.orderCreatedAt||i.created_at,averageOrderValue:a/o,daysSinceFirstOrder:l?Math.floor((new Date-new Date(l.orderCreatedAt||l.created_at))/864e5):0};$(r,c)}console.log("\uD83D\uDCCA Analytics tracked for order completion")}catch(e){console.error("\uD83D\uDCCA Error tracking analytics:",e)}p();let r=new CustomEvent("newOrderCompleted",{detail:{order:i,orderCount:n,message:"Order ".concat(i.orderNumber," completed successfully!")}});window.dispatchEvent(r);return}console.log("⏳ New orders detected but none are paid yet, continuing to monitor..."),o(n)}}}catch(e){console.error("❌ Error during order monitoring:",e)}},3e3),setTimeout(()=>{e&&(console.log("⏰ Order monitoring auto-stopped after 10 minutes"),p())},6e5)):void console.log("⚠️ No user context - skipping order monitoring"),[e,r,c,d]),p=(0,a.useCallback)(()=>{n.current&&(clearInterval(n.current),n.current=null),t(!1),console.log("\uD83D\uDED1 Order completion monitoring stopped")},[]);return{startMonitoring:u,stopMonitoring:p,isMonitoring:e}};var M=r(67759),V=r(46059),W=r(77143);let H=e=>{var t,r,o;let{cartItems:c,className:d="",children:u,discountCode:p,discountAmount:m,onCheckoutStart:h,onCheckoutError:g,onCheckoutSuccess:f,creditsToApply:x=0,onCreditsChange:v,isBlindShipment:_=!1,guestCheckoutData:b}=e,y=(0,s.useRouter)(),[w,k]=(0,a.useState)(null),{processCheckout:C,loading:S,error:I}=j(),{startMonitoring:N,stopMonitoring:A,isMonitoring:E}=z(),{clearCart:P}=(0,M._)(),[O,F]=(0,a.useState)(!1),[q,U]=(0,a.useState)(x),[L,R]=(0,a.useState)(!1),[$,H]=(0,a.useState)(""),[J]=(0,l.n)(W.rq);(0,a.useEffect)(()=>{U(x)},[x]);let{data:Y}=(0,D.IT)(V.IO,{variables:{userId:null==w?void 0:w.id},skip:!(null==w?void 0:w.id)}),G=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"";(0,a.useEffect)(()=>{(async()=>{try{{let e=(0,i.b)(),{data:{session:t}}=await e.auth.getSession();k((null==t?void 0:t.user)||null)}}catch(e){console.error("Error getting user:",e)}})()},[]),(0,a.useEffect)(()=>{let e=e=>{console.log("\uD83C\uDF89 Order completion detected!",e.detail),console.log("\uD83D\uDED2 Clearing cart due to order completion event"),P(),null==f||f(),setTimeout(()=>{y.push("/account/dashboard?orderCompleted=true")},1e3)};return window.addEventListener("newOrderCompleted",e),()=>{window.removeEventListener("newOrderCompleted",e),A()}},[y,f,A,P]),(0,a.useEffect)(()=>{let e=()=>{let e=new URLSearchParams(window.location.search);sessionStorage.getItem("stripe_checkout_initiated")&&e.get("session_id")&&(console.log("\uD83D\uDD04 Detected return from Stripe with session_id - clearing cart as fallback"),P(),sessionStorage.removeItem("stripe_checkout_initiated"))};return e(),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[P]);let K=()=>{$&&$.includes("@")&&(R(!1),X())},X=async()=>{null==h||h();try{var e,t,r,o,n,a,s,i;let l=c.reduce((e,t)=>e+(t.totalPrice||0),0);if(T("checkout_initiated",{totalPrice:l,items:c},w),B("checkout_started",{cart_value:l,items_count:c.length,user_type:w?"registered":"guest"}),window.fbq)try{let e=c.map(e=>{var t;return(null==(t=e.product)?void 0:t.id)||e.id||"custom"}),t=c.map(e=>{var t;return{id:(null==(t=e.product)?void 0:t.id)||e.id||"custom",quantity:e.quantity||1,item_price:e.unitPrice||e.price||0}});window.fbq("track","InitiateCheckout",{content_ids:e,contents:t,currency:"USD",num_items:c.length,value:l}),console.log("\uD83D\uDCCA Facebook Pixel: InitiateCheckout tracked",{num_items:c.length,value:l})}catch(e){console.error("\uD83D\uDCCA Facebook Pixel InitiateCheckout tracking error:",e)}if(!w&&!b&&!$)return void R(!0);console.log("\uD83D\uDE80 Phase 2: Direct enhanced checkout...");let d=b||{firstName:"",lastName:"",email:$||""};console.log("\uD83D\uDC64 User context:",w?"Logged in as ".concat(G((null==(e=w.user_metadata)?void 0:e.first_name)||(null==(t=w.email)?void 0:t.split("@")[0])||"User")):"Guest user: ".concat(d.email)),sessionStorage.setItem("stripe_checkout_initiated","true"),!w&&b&&sessionStorage.setItem("guest_checkout_data",JSON.stringify(b));let u={firstName:(null==w||null==(r=w.user_metadata)?void 0:r.first_name)||d.firstName||"",lastName:(null==w||null==(o=w.user_metadata)?void 0:o.last_name)||d.lastName||"",email:(null==w?void 0:w.email)||d.email||"",phone:(null==w||null==(n=w.user_metadata)?void 0:n.phone)||""},h=u.email;if(h)try{console.log("\uD83D\uDCE7 Tracking Started Checkout event in Klaviyo for:",h);let e=c.reduce((e,t)=>e+(t.totalPrice||0),0);await J({variables:{email:h,eventName:"Started Checkout",properties:{$event_id:"checkout_".concat(Date.now()),$value:e,items:c.map(e=>{var t,r,o,n,a,s,i,l,c,d,u;return{product_name:(null==(t=e.product)?void 0:t.name)||e.name||"Custom Stickers",product_id:(null==(r=e.product)?void 0:r.id)||e.productId||"custom",quantity:e.quantity||1,price:e.unitPrice||e.price||0,total:e.totalPrice||0,customization:{size:(null==(a=e.customization)||null==(n=a.selections)||null==(o=n.size)?void 0:o.displayValue)||'Medium (3")',material:(null==(l=e.customization)||null==(i=l.selections)||null==(s=i.finish)?void 0:s.value)||"default",shape:(null==(u=e.customization)||null==(d=u.selections)||null==(c=d.shape)?void 0:c.value)||"custom"}}}),item_count:c.length,cart_total:e,discount_code:p||null,discount_amount:m||0,credits_to_apply:x||0,checkout_url:window.location.href,timestamp:new Date().toISOString()}}}),console.log("✅ Started Checkout event tracked in Klaviyo")}catch(e){console.error("⚠️ Failed to track Klaviyo event (non-blocking):",e)}let g={first_name:(null==w||null==(a=w.user_metadata)?void 0:a.first_name)||d.firstName||"",last_name:(null==w||null==(s=w.user_metadata)?void 0:s.last_name)||d.lastName||"",address1:"",address2:"",city:"",province:"",country:"United States",zip:"",phone:(null==w||null==(i=w.user_metadata)?void 0:i.phone)||""};w&&N();let f=await C(c,u,g,null,"",p,m||void 0,x||0,_);if(f.success)console.log("✅ Phase 2: Direct checkout successful! Starting order monitoring...");else throw sessionStorage.removeItem("stripe_checkout_initiated"),A(),Error(f.error||"Checkout failed")}catch(t){let e=t instanceof Error?t.message:"Checkout failed";console.error("❌ Phase 2: Direct checkout error:",e),sessionStorage.removeItem("stripe_checkout_initiated"),A(),null==g||g(e)}};return(0,n.jsxs)(n.Fragment,{children:[L&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"rounded-2xl p-6 max-w-md w-full mx-4",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"rgba(0, 0, 0, 0.3) 0px 8px 32px, rgba(255, 255, 255, 0.1) 0px 1px 0px inset",backdropFilter:"blur(12px)"},children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Enter Your Email"}),(0,n.jsx)("p",{className:"text-gray-300 mb-6",children:"We need your email address to process your order and send you updates."}),(0,n.jsx)("input",{type:"email",value:$,onChange:e=>H(e.target.value),placeholder:"your.email@example.com",className:"w-full px-4 py-3 rounded-lg text-white mb-4",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)"},onKeyPress:e=>{"Enter"===e.key&&K()}}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:()=>R(!1),className:"flex-1 px-4 py-2 rounded-lg text-white border border-gray-500 hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,n.jsx)("button",{onClick:K,disabled:!$||!$.includes("@"),className:"flex-1 px-4 py-2 rounded-lg text-white font-semibold transition-all disabled:opacity-50",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.4) 0%, rgba(59, 130, 246, 0.25) 50%, rgba(59, 130, 246, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(59, 130, 246, 0.4)",boxShadow:"rgba(59, 130, 246, 0.3) 0px 8px 32px, rgba(255, 255, 255, 0.2) 0px 1px 0px inset"},children:"Continue"})]})]})}),(0,n.jsx)("button",{onClick:X,disabled:S||0===c.length,className:d||"\n    block p-4 shadow-2xl hover:shadow-3xl transition-all duration-500 transform hover:scale-105 \n    text-left w-full relative overflow-hidden rounded-2xl\n    disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n  ".trim(),style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.4) 0%, rgba(16, 185, 129, 0.25) 50%, rgba(16, 185, 129, 0.1) 100%)",backdropFilter:"blur(25px) saturate(180%)",border:"1px solid rgba(16, 185, 129, 0.4)",boxShadow:"0 4px 16px rgba(16, 185, 129, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:S?(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),(0,n.jsx)("span",{className:"text-white font-semibold",children:"Processing..."})]}):(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"p-2 rounded-lg",style:{background:"linear-gradient(135deg, #10b981, #34d399)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.15)"},children:(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-semibold text-white text-sm",children:u||"\uD83D\uDE80 Go to Checkout"}),w&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"text-xs text-green-200",children:["Logged in as ",G((null==(t=w.user_metadata)?void 0:t.first_name)||(null==(r=w.email)?void 0:r.split("@")[0])||"User")]}),(null==Y||null==(o=Y.getUserCreditBalance)?void 0:o.balance)>0&&(0,n.jsxs)("p",{className:"text-xs text-green-300 mt-1",children:["$",Y.getUserCreditBalance.balance.toFixed(2)," store credit available"]})]})]})]})})})]})}}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f1828cc2-2298-5302-bc6d-1217e58869fc")}catch(e){}}();
//# debugId=f1828cc2-2298-5302-bc6d-1217e58869fc
